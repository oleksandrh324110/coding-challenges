var S=function(p){const _={LIBRARY:"p5.EasyCam",VERSION:"1.2.2",AUTHOR:"p5.EasyCam authors",SOURCE:"https://github.com/freshfork/p5.EasyCam",toString:function(){return this.LIBRARY+" v"+this.VERSION+" by "+this.AUTHOR+" ("+this.SOURCE+")"}};class M{constructor(t,e){if(!(t instanceof p5.RendererGL)){console.log("renderer needs to be an instance of p5.RendererGL");return}var o=t.elt.getBoundingClientRect();e=e||{},e.distance===void 0&&(e.distance=500),e.center===void 0&&(e.center=[0,0,0]),e.rotation===void 0&&(e.rotation=m.identity()),e.viewport===void 0&&(e.viewport=[0,0,t.width,t.height]),e.offset===void 0&&(e.offset=[o.x+window.scrollX,o.y+window.scrollY]),this.INFO=_,this.setCanvas(t);var a=this;this.cam=a,this.LOOK=[0,0,1],this.UP=[0,1,0],this.AXIS=new function(){this.YAW=1,this.PITCH=2,this.ROLL=4,this.ALL=this.YAW|this.PITCH|this.ROLL},this.SHIFT_CONSTRAINT=0,this.FIXED_CONSTRAINT=0,this.DRAG_CONSTRAINT=0,this.scale_rotation=.001,this.scale_pan=2e-4,this.scale_zoom=.001,this.scale_zoomwheel=20,this.distance_min_limit=.01,this.distance_min=1,this.distance_max=Number.MAX_VALUE,this.state={distance:e.distance,center:e.center.slice(),rotation:e.rotation.slice(),copy:function(i){return i=i||{},i.distance=this.distance,i.center=this.center.slice(),i.rotation=this.rotation.slice(),i}},this.state_reset=this.state.copy(),this.state_pushed=this.state.copy(),this.viewport=e.viewport.slice(),this.offset=e.offset.slice(),window.addEventListener("resize",function(i){let s=t.elt.getBoundingClientRect();a.offset=[s.x+window.scrollX,s.y+window.scrollY]}),this.mouse={cam:a,curr:[0,0,0],prev:[0,0,0],dist:[0,0,0],mwheel:0,isPressed:!1,istouchdown:!1,ismousedown:!1,BUTTON:{LMB:1,MMB:2,RMB:4},button:0,mouseDragLeft:a.mouseDragRotate.bind(a),mouseDragCenter:a.mouseDragPan.bind(a),mouseDragRight:a.mouseDragZoom.bind(a),mouseWheelAction:a.mouseWheelZoom.bind(a),touchmoveSingle:a.mouseDragRotate.bind(a),touchmoveMulti:function(){a.mouseDragPan(),a.mouseDragZoom()},insideViewport:function(i,s){var u=a.viewport[0],r=u+a.viewport[2],h=a.viewport[1],c=h+a.viewport[3];return i>u&&i<r&&s>h&&s<c},solveConstraint:function(){var i=this.dist[0],s=this.dist[1];this.shiftKey&&!a.SHIFT_CONSTRAINT&&Math.abs(i-s)>1&&(a.SHIFT_CONSTRAINT=Math.abs(i)>Math.abs(s)?a.AXIS.YAW:a.AXIS.PITCH),a.DRAG_CONSTRAINT=a.AXIS.ALL,a.FIXED_CONSTRAINT&&(a.DRAG_CONSTRAINT=a.FIXED_CONSTRAINT),a.SHIFT_CONSTRAINT&&(a.DRAG_CONSTRAINT=a.SHIFT_CONSTRAINT)},updateInput:function(i,s,u){var r=a.mouse,h=a.P5.pixelDensity();r.prev[0]=r.curr[0],r.prev[1]=r.curr[1],r.prev[2]=r.curr[2],r.curr[0]=i,r.curr[1]=s,r.curr[2]=u,r.dist[0]=-(r.curr[0]-r.prev[0])/h,r.dist[1]=-(r.curr[1]-r.prev[1])/h,r.dist[2]=-(r.curr[2]-r.prev[2])/h},mousedown:function(i){var s=a.mouse,u=a.offset[0]-window.scrollX,r=a.offset[1]-window.scrollY;i.button===0&&(s.button|=s.BUTTON.LMB),i.button===1&&(s.button|=s.BUTTON.MMB),i.button===2&&(s.button|=s.BUTTON.RMB),s.insideViewport(i.x-u,i.y-r)&&(s.updateInput(i.x-u,i.y-r,i.y-r),s.ismousedown=s.button>0,s.isPressed=s.ismousedown,a.SHIFT_CONSTRAINT=0)},mousedrag:function(){a.P5.pixelDensity();var i=a.mouse;if(i.ismousedown){var s=a.P5.mouseX,u=a.P5.mouseY,r=u;i.updateInput(s,u,r),i.solveConstraint();var h=i.button&i.BUTTON.LMB,c=i.button&i.BUTTON.MMB,d=i.button&i.BUTTON.RMB;h&&i.mouseDragLeft&&i.mouseDragLeft(),c&&i.mouseDragCenter&&i.mouseDragCenter(),d&&i.mouseDragRight&&i.mouseDragRight()}},mouseup:function(i){var s=a.mouse;i.button===0&&(s.button&=~s.BUTTON.LMB),i.button===1&&(s.button&=~s.BUTTON.MMB),i.button===2&&(s.button&=~s.BUTTON.RMB),s.ismousedown=s.button>0,s.isPressed=s.istouchdown||s.ismousedown,a.SHIFT_CONSTRAINT=0},dblclick:function(i){var s=a.offset[0]-window.scrollX,u=a.offset[1]-window.scrollY;a.mouse.insideViewport(i.x-s,i.y-u)&&a.reset()},wheel:function(i){var s=i.x,u=i.y,r=a.mouse;r.insideViewport(s,u)&&(r.mwheel=i.deltaY*.01,r.mouseWheelAction&&r.mouseWheelAction())},evaluateTouches:function(i){var s=i.touches,u=0,r=0,h=0,c,d,l,v=s.length,g=a.offset[0]-window.scrollX,T=a.offset[1]-window.scrollY;for(c=0;c<v;c++)u+=s[c].clientX-g,r+=s[c].clientY-T;for(u/=v,r/=v,c=0;c<v;c++)d=u-(s[c].clientX-g),l=r-(s[c].clientY-T),h+=Math.sqrt(d*d+l*l);h/=v,a.mouse.updateInput(u,r,-h)},touchstart:function(i){i.preventDefault(),i.stopPropagation();var s=a.mouse;s.evaluateTouches(i),s.istouchdown=s.insideViewport(s.curr[0],s.curr[1]),s.isPressed=a.mouse.istouchdown||a.mouse.ismousedown,s.dbltap(i)},touchmove:function(i){i.preventDefault(),i.stopPropagation();var s=a.mouse;s.istouchdown&&(s.evaluateTouches(i),s.solveConstraint(),i.touches.length===1?s.touchmoveSingle():(s.touchmoveMulti(),s.tapcount=0))},touchend:function(i){i.preventDefault(),i.stopPropagation();var s=a.mouse;s.istouchdown=!1,s.isPressed=s.istouchdown||s.ismousedown,a.SHIFT_CONSTRAINT=0,s.tapcount>=2&&(s.insideViewport(s.curr[0],s.curr[1])&&a.reset(),s.tapcount=0)},tapcount:0,dbltap:function(i){a.mouse.tapcount++==0&&setTimeout(function(){a.mouse.tapcount=0},350)},shiftKey:!1,keydown:function(i){var s=a.mouse;s.shiftKey||(s.shiftKey=i.keyCode===16)},keyup:function(i){var s=a.mouse;s.shiftKey&&(s.shiftKey=i.keyCode!==16,s.shiftKey||(a.SHIFT_CONSTRAINT=0))}},this.attachMouseListeners(),this.auto_update=!0,this.P5.registerMethod("pre",function(){a.auto_update&&a.update()}),this.dampedZoom=new R(function(i){a.zoom(i*a.getZoomMult())}),this.dampedPanX=new R(function(i){a.panX(i*a.getPanMult())}),this.dampedPanY=new R(function(i){a.panY(i*a.getPanMult())}),this.dampedRotX=new R(function(i){a.rotateX(i*a.getRotationMult())}),this.dampedRotY=new R(function(i){a.rotateY(i*a.getRotationMult())}),this.dampedRotZ=new R(function(i){a.rotateZ(i*a.getRotationMult())}),this.timedRot=new A(a.setInterpolatedRotation.bind(a)),this.timedPan=new A(a.setInterpolatedCenter.bind(a)),this.timedzoom=new A(a.setInterpolatedDistance.bind(a))}setCanvas(t){t instanceof p5.RendererGL?(this.renderer=t,t._pInst instanceof p5?this.graphics=t:this.graphics=t._pInst,this.P5=this.graphics._pInst):(this.graphics=void 0,this.renderer=void 0)}getCanvas(){return this.renderer}attachListener(t,e,o,a){!t||t===o.el||(this.detachListener(o),o.el=t,o.ev=e,o.op=a,o.el.addEventListener(o.ev,o,o.op))}detachListener(t){t.el&&(t.el.removeEventListener(t.ev,t,t.op),t.el=void 0)}attachMouseListeners(t){var e=this.cam,o=e.mouse;if(t=t||e.renderer,t){var a={passive:!1},i=t.elt;e.attachListener(i,"mousedown",o.mousedown,a),e.attachListener(i,"mouseup",o.mouseup,a),e.attachListener(i,"dblclick",o.dblclick,a),e.attachListener(i,"wheel",o.wheel,a),e.attachListener(i,"touchstart",o.touchstart,a),e.attachListener(i,"touchend",o.touchend,a),e.attachListener(i,"touchmove",o.touchmove,a),e.attachListener(window,"keydown",o.keydown,a),e.attachListener(window,"keyup",o.keyup,a)}}removeMouseListeners(){var t=this.cam,e=t.mouse;t.detachListener(e.mousedown),t.detachListener(e.mouseup),t.detachListener(e.dblclick),t.detachListener(e.wheel),t.detachListener(e.keydown),t.detachListener(e.keyup),t.detachListener(e.touchstart),t.detachListener(e.touchend),t.detachListener(e.touchmove)}dispose(){removeMouseListeners()}getAutoUpdate(){return this.auto_update}setAutoUpdate(t){this.auto_update=t}update(){var t=this.cam,e=t.mouse;e.mousedrag();var o=!1;o|=t.dampedZoom.update(),o|=t.dampedPanX.update(),o|=t.dampedPanY.update(),o|=t.dampedRotX.update(),o|=t.dampedRotY.update(),o|=t.dampedRotZ.update(),o?(t.timedRot.stop(),t.timedPan.stop(),t.timedzoom.stop()):(t.timedRot.update(),t.timedPan.update(),t.timedzoom.update()),t.apply()}apply(t){var e=this.cam;t=t||e.renderer,t&&(this.camEYE=this.getPosition(this.camEYE),this.camLAT=this.getCenter(this.camLAT),this.camRUP=this.getUpVector(this.camRUP),t._curCamera===void 0?t.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]):t._curCamera.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]))}setViewport(t){this.viewport=t.slice()}getViewport(){return this.viewport}mouseWheelZoom(){var t=this,e=t.mouse;t.dampedZoom.addForce(e.mwheel*t.scale_zoomwheel)}mouseDragZoom(){var t=this,e=t.mouse;t.dampedZoom.addForce(-e.dist[2])}mouseDragPan(){var t=this,e=t.mouse;t.dampedPanX.addForce(t.DRAG_CONSTRAINT&t.AXIS.YAW?e.dist[0]:0),t.dampedPanY.addForce(t.DRAG_CONSTRAINT&t.AXIS.PITCH?e.dist[1]:0)}mouseDragRotate(){var t=this,e=t.mouse,o=e.curr[0],a=e.curr[1],i=e.dist[0],s=e.dist[1],u=Math.min(Math.max((o-t.viewport[0])/t.viewport[2],0),1)*2-1,r=Math.min(Math.max((a-t.viewport[1])/t.viewport[3],0),1)*2-1;t.DRAG_CONSTRAINT&t.AXIS.YAW&&t.dampedRotY.addForce(+i*(1-r*r)),t.DRAG_CONSTRAINT&t.AXIS.PITCH&&t.dampedRotX.addForce(-s*(1-u*u)),t.DRAG_CONSTRAINT&t.AXIS.ROLL&&(t.dampedRotZ.addForce(-i*r),t.dampedRotZ.addForce(+s*u))}getZoomMult(){return this.state.distance*this.scale_zoom}getPanMult(){return this.state.distance*this.scale_pan}getRotationMult(){return Math.pow(Math.log10(1+this.state.distance),.5)*this.scale_rotation}zoom(t){var e=this.cam,o=e.state.distance+t;o<e.distance_min&&(o=e.distance_min,e.dampedZoom.stop()),o>e.distance_max&&(o=e.distance_max,e.dampedZoom.stop()),e.state.distance=o}panX(t){var e=this.cam.state;if(t){var o=m.applyToVec3(e.rotation,[t,0,0]);f.add(e.center,o,e.center)}}panY(t){var e=this.cam.state;if(t){var o=m.applyToVec3(e.rotation,[0,t,0]);f.add(e.center,o,e.center)}}pan(t,e){this.cam.panX(t),this.cam.panY(t)}rotateX(t){this.cam.rotate([1,0,0],t)}rotateY(t){this.cam.rotate([0,1,0],t)}rotateZ(t){this.cam.rotate([0,0,1],t)}rotate(t,e){var o=this.cam.state;if(e){var a=m.create({axis:t,angle:e});m.applyToRotation(o.rotation,a,o.rotation)}}setInterpolatedDistance(t,e,o){this.cam.state.distance=w.mix(t,e,w.smoothstep(o))}setInterpolatedCenter(t,e,o){this.cam.state.center=f.mix(t,e,w.smoothstep(o))}setInterpolatedRotation(t,e,o){this.cam.state.rotation=m.slerp(t,e,o)}setDistanceMin(t){this.distance_min=Math.max(t,this.distance_min_limit),this.zoom(0)}setDistanceMax(t){this.distance_max=t,this.zoom(0)}setDistance(t,e){this.timedzoom.start(this.state.distance,t,e,[this.dampedZoom])}getDistance(){return this.state.distance}setCenter(t,e){this.timedPan.start(this.state.center,t,e,[this.dampedPanX,this.dampedPanY])}getCenter(){return this.state.center}setRotation(t,e){this.timedRot.start(this.state.rotation,t,e,[this.dampedRotX,this.dampedRotY,this.dampedRotZ])}getRotation(){return this.state.rotation}getPosition(t){var e=this.cam,o=e.state;return t=f.assert(t),m.applyToVec3(o.rotation,e.LOOK,t),f.mult(t,o.distance,t),f.add(t,o.center,t),t}getUpVector(t){var e=this.cam,o=e.state;return t=f.assert(t),m.applyToVec3(o.rotation,e.UP,t),t}getState(){return this.state.copy()}setState(t,e){t&&(this.setDistance(t.distance,e),this.setCenter(t.center,e),this.setRotation(t.rotation,e))}pushState(){return this.state_pushed=this.getState()}popState(t){this.setState(this.state_pushed,t)}pushResetState(){return this.state_reset=this.getState()}reset(t){this.setState(this.state_reset,t)}setRotationScale(t){this.scale_rotation=t}setPanScale(t){this.scale_pan=t}setZoomScale(t){this.scale_zoom=t}setWheelScale(t){this.scale_zoomwheel=t}getRotationScale(){return this.scale_rotation}getPanScale(){return this.scale_pan}getZoomScale(){return this.scale_zoom}getWheelScale(){return this.scale_zoomwheel}setDamping(t){this.dampedZoom.damping=t,this.dampedPanX.damping=t,this.dampedPanY.damping=t,this.dampedRotX.damping=t,this.dampedRotY.damping=t,this.dampedRotZ.damping=t}setDefaultInterpolationTime(t){this.timedRot.default_duration=t,this.timedPan.default_duration=t,this.timedzoom.default_duration=t}setRotationConstraint(t,e,o){var a=this.cam;a.FIXED_CONSTRAINT=0,a.FIXED_CONSTRAINT|=t?a.AXIS.YAW:0,a.FIXED_CONSTRAINT|=e?a.AXIS.PITCH:0,a.FIXED_CONSTRAINT|=o?a.AXIS.ROLL:0}beginHUD(t,s,u){var a=this.cam;if(t=t||a.renderer,!!t){this.pushed_rendererState=t.push();var i=t.drawingContext,s=s!==void 0?s:t.width,u=u!==void 0?u:t.height,r=Number.MAX_VALUE;i.flush(),i.disable(i.DEPTH_TEST),this.pushed_uMVMatrix=t.uMVMatrix.copy(),this.pushed_uPMatrix=t.uPMatrix.copy(),t.uMVMatrix=p5.Matrix.identity(),t._curCamera.ortho(0,s,-u,0,-r,+r)}}endHUD(t){var e=this.cam;if(t=t||e.renderer,!!t){var o=t.drawingContext;o.flush(),t.uMVMatrix.set(this.pushed_uMVMatrix),t.uPMatrix.set(this.pushed_uPMatrix),o.enable(o.DEPTH_TEST),t.pop(this.pushed_rendererState)}}}class R{constructor(t){this.value=0,this.damping=.85,this.action=t}addForce(t){this.value+=t}update(){var t=this.value*this.value>1e-6;return t?(this.action(this.value),this.value*=this.damping):this.stop(),t}stop(){this.value=0}}class A{constructor(t){this.default_duration=300,this.action=t}start(t,e,o,a){for(var i in a)a[i].stop();this.valA=t,this.valB=e,this.duration=o===void 0?this.default_duration:o,this.timer=new Date().getTime(),this.active=this.duration>0,this.active||this.interpolate(1)}update(){if(this.active){var t=(new Date().getTime()-this.timer)/this.duration;t>.995?(this.interpolate(1),this.stop()):this.interpolate(t)}}interpolate(t){this.action(this.valA,this.valB,t)}stop(){this.active=!1}}var m={assert:function(n){return n===void 0||n.constructor!==Array?[1,0,0,0]:n},identity:function(){return[1,0,0,0]},applyToVec3:function(n,t,e){var[o,a,i]=t,[s,u,r,h]=n,c=u*o+r*a+h*i;return e=f.assert(e),e[0]=2*(s*(o*s-(r*i-h*a))+c*u)-o,e[1]=2*(s*(a*s-(h*o-u*i))+c*r)-a,e[2]=2*(s*(i*s-(u*a-r*o))+c*h)-i,e},applyToRotation(n,t,e){var[o,a,i,s]=n,[u,r,h,c]=t;return e=m.assert(e),e[0]=u*o-(r*a+h*i+c*s),e[1]=r*o+u*a+(h*s-c*i),e[2]=h*o+u*i+(c*a-r*s),e[3]=c*o+u*s+(r*i-h*a),e},slerp:function(n,t,e,o){var[a,i,s,u]=n,[r,h,c,d]=t,l=a*r+i*h+s*c+u*d;l<0&&(r=-r,h=-h,c=-c,d=-d,l=-l);var v=Math.acos(l),g=Math.sqrt(1-l*l),T,I;return g>.001?(T=Math.sin((1-e)*v)/g,I=Math.sin(e*v)/g):(T=1-e,I=e),o=m.assert(o),o[0]=T*a+I*r,o[1]=T*i+I*h,o[2]=T*s+I*c,o[3]=T*u+I*d,m.create({rotation:o,normalize:!0},o)},create:function(n,t){if(t=m.assert(t),n.axis){var e=n.axis,o=n.angle,a=f.mag(e);if(a==0)return;var i=-.5*o,s=Math.sin(i)/a;return t[0]=Math.cos(i),t[1]=s*e[0],t[2]=s*e[1],t[3]=s*e[2],t}if(n.rotation){if(t[0]=n.rotation[0],t[1]=n.rotation[1],t[2]=n.rotation[2],t[3]=n.rotation[3],n.normalize){var u=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);t[0]*=u,t[1]*=u,t[2]*=u,t[3]*=u}return t}if(n.angles_xyz){var r=-.5*n.angles_xyz[0],h=-.5*n.angles_xyz[1],c=-.5*n.angles_xyz[2],d=[Math.cos(r),Math.sin(r),0,0],l=[Math.cos(h),0,Math.sin(h),0],v=[Math.cos(c),0,0,Math.sin(c)];return m.applyToRotation(l,v,t),m.applyToRotation(d,t,t),t}}},w={mix:function(n,t,e){return n*(1-e)+t*e},smoothstep:function(n){return n*n*(3-2*n)},smootherstep:function(n){return x*x*x*(x*(x*6-15)+10)}},f={assert:function(n){return n===void 0||n.constructor!==Array?[0,0,0]:n},isScalar:function(n){return n!==void 0&&n.constructor!==Array},add:function(n,t,e){return e=this.assert(e),this.isScalar(t)?(e[0]=n[0]+t,e[1]=n[1]+t,e[2]=n[2]+t):(e[0]=n[0]+t[0],e[1]=n[1]+t[1],e[2]=n[2]+t[2]),e},mult:function(n,t,e){return e=this.assert(e),this.isScalar(t)?(e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t):(e[0]=n[0]*t[0],e[1]=n[1]*t[1],e[2]=n[2]*t[2]),e},magSq:function(n){return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},mag:function(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},dot:function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},cross:function(n,t,e){return e=this.assert(e),e[0]=n[1]*t[2]-n[2]*t[1],e[1]=n[2]*t[0]-n[0]*t[2],e[2]=n[0]*t[1]-n[1]*t[0],e},angle:function(n,t){var e=this.mag(n)*this.mag(t);if(e===0)return 0;var o=this.dot(n,t),a=e*.9999;if(o<-a||o>a){var i=this.cross(n,t);return o>=0?Math.asin(this.mag(i)/e):Math.PI-Math.asin(this.mag(i)/e)}return Math.acos(o/e)},mix(n,t,e,o){return o=this.assert(o),o[0]=w.mix(n[0],t[0],e),o[1]=w.mix(n[1],t[1],e),o[2]=w.mix(n[2],t[2],e),o}};return M.INFO=_,Object.freeze(_),p=p!==void 0?p:{},p.EasyCam=M,p.DampedAction=R,p.Interpolation=A,p.Rotation=m,p.Vec3=f,p.Scalar=w,p}(S);p5&&(p5.prototype.createEasyCam=function(){var p=this._renderer,_=arguments[0];return arguments[0]instanceof p5.RendererGL&&(p=arguments[0],_=arguments[1]),new S.EasyCam(p,_)});
